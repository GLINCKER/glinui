import { getRegistryItem } from "@glinui/registry"
import { Tree } from "@glinui/ui"
import { ComponentDocLayout } from "@/components/docs/component-doc-layout"
import { ExampleBlock } from "@/components/docs/example-block"
import { InstallTabs } from "@/components/docs/install-tabs"
import { getComponentSources } from "@/lib/get-component-source"
import { PropsTable } from "@/components/docs/props-table"

export const dynamic = "force-static"
export const item = getRegistryItem("tree")
export const sources = getComponentSources(item?.files)
export const metadata = {
  title: "Tree - Glin UI",
  description: item?.description ?? "Hierarchical tree view for file structures, navigation, and nested data."
}

export const basicNodes = [
  {
    label: "src",
    children: [
      {
        label: "components",
        children: [
          { label: "button.tsx" },
          { label: "input.tsx" },
          { label: "card.tsx" }
        ]
      },
      { label: "index.ts" },
      { label: "App.tsx" }
    ]
  },
  { label: "package.json" },
  { label: "tsconfig.json" }
]

export const badgeNodes = [
  {
    label: "packages",
    children: [
      { label: "ui", badge: "stable", badgeVariant: "success", children: [{ label: "index.ts" }] },
      { label: "tokens", badge: "stable", badgeVariant: "success", children: [{ label: "theme.css" }] },
      { label: "motion", badge: "beta", badgeVariant: "warning", children: [{ label: "index.ts" }] },
      { label: "registry", badge: "wip", badgeVariant: "info", children: [{ label: "index.ts" }] }
    ]
  }
]

export const flatPaths = [
  "src/components/button.tsx",
  "src/components/input.tsx",
  "src/lib/cn.ts",
  "src/lib/utils.ts",
  "src/index.ts",
  "package.json"
]

export const buildFileTreePreviewNodes = [
  {
    label: "src",
    children: [
      {
        label: "components",
        children: [{ label: "button.tsx" }, { label: "input.tsx" }]
      },
      {
        label: "lib",
        children: [{ label: "cn.ts" }, { label: "utils.ts" }]
      },
      { label: "index.ts" }
    ]
  },
  { label: "package.json" }
]

<ComponentDocLayout
  badgeLabel="Primitive / Atom"
  componentId="tree"
  implementation="css"
  title="Tree"
  description={item?.description ?? "Hierarchical tree view for file structures, navigation, and nested data."}
>
  ## Installation

  ### Package Manager

  <InstallTabs sources={sources} command={item?.install.package ?? "npm install @glinui/ui @glinui/tokens"} />

  ### Registry

  <InstallTabs command={item?.install.registry ?? "pnpm dlx @glinui/cli@latest add tree"} />

  ## Usage

  Pass a `nodes` array of `TreeNode` objects. Nodes with a `children` array render as expandable folders; leaf nodes without `children` render as files. Folders are expanded by default.

  <ExampleBlock
    codeDefaultOpen
    code={`import { Tree } from "@glinui/ui"

const nodes = [
  {
    label: "src",
    children: [
      {
        label: "components",
        children: [
          { label: "button.tsx" },
          { label: "input.tsx" },
          { label: "card.tsx" }
        ]
      },
      { label: "index.ts" },
      { label: "App.tsx" }
    ]
  },
  { label: "package.json" },
  { label: "tsconfig.json" }
]

export function TreeBasicDemo() {
  return <Tree nodes={nodes} className="max-w-xs" />
}`}
  >
    <Tree nodes={basicNodes} className="max-w-xs" />
  </ExampleBlock>

  ## Examples

  ### Glass Variant

  The `glass` variant applies `backdrop-blur` and a subtle surface tint, suitable for floating panels and sidebars on blurred backgrounds.

  <ExampleBlock
    code={`import { Tree } from "@glinui/ui"

const nodes = [
  {
    label: "src",
    children: [
      { label: "components", children: [{ label: "button.tsx" }, { label: "input.tsx" }] },
      { label: "index.ts" }
    ]
  },
  { label: "package.json" }
]

export function TreeGlassDemo() {
  return (
    <div className="bg-gradient-to-br from-neutral-950 to-neutral-900 rounded-xl p-6">
      <Tree nodes={nodes} variant="glass" className="max-w-xs" />
    </div>
  )
}`}
  >
    <div className="bg-gradient-to-br from-neutral-950 to-neutral-900 rounded-xl p-6">
      <Tree nodes={basicNodes} variant="glass" className="max-w-xs" />
    </div>
  </ExampleBlock>

  ### All Variants

  Four surface variants match the design system â€” `default`, `glass`, `outline`, and `ghost`.

  <ExampleBlock
    code={`import { Tree } from "@glinui/ui"

const nodes = [
  { label: "src", children: [{ label: "index.ts" }, { label: "App.tsx" }] },
  { label: "package.json" }
]

export function TreeVariantsDemo() {
  return (
    <div className="grid grid-cols-2 gap-4">
      <div>
        <p className="mb-2 text-xs font-semibold text-neutral-500 uppercase tracking-widest">Default</p>
        <Tree nodes={nodes} variant="default" />
      </div>
      <div>
        <p className="mb-2 text-xs font-semibold text-neutral-500 uppercase tracking-widest">Glass</p>
        <Tree nodes={nodes} variant="glass" />
      </div>
      <div>
        <p className="mb-2 text-xs font-semibold text-neutral-500 uppercase tracking-widest">Outline</p>
        <Tree nodes={nodes} variant="outline" />
      </div>
      <div>
        <p className="mb-2 text-xs font-semibold text-neutral-500 uppercase tracking-widest">Ghost</p>
        <Tree nodes={nodes} variant="ghost" />
      </div>
    </div>
  )
}`}
  >
    <div className="grid grid-cols-2 gap-4">
      <div>
        <p className="mb-2 text-xs font-semibold text-neutral-500 uppercase tracking-widest">Default</p>
        <Tree nodes={[{ label: "src", children: [{ label: "index.ts" }, { label: "App.tsx" }] }, { label: "package.json" }]} variant="default" />
      </div>
      <div>
        <p className="mb-2 text-xs font-semibold text-neutral-500 uppercase tracking-widest">Glass</p>
        <Tree nodes={[{ label: "src", children: [{ label: "index.ts" }, { label: "App.tsx" }] }, { label: "package.json" }]} variant="glass" />
      </div>
      <div>
        <p className="mb-2 text-xs font-semibold text-neutral-500 uppercase tracking-widest">Outline</p>
        <Tree nodes={[{ label: "src", children: [{ label: "index.ts" }, { label: "App.tsx" }] }, { label: "package.json" }]} variant="outline" />
      </div>
      <div>
        <p className="mb-2 text-xs font-semibold text-neutral-500 uppercase tracking-widest">Ghost</p>
        <Tree nodes={[{ label: "src", children: [{ label: "index.ts" }, { label: "App.tsx" }] }, { label: "package.json" }]} variant="ghost" />
      </div>
    </div>
  </ExampleBlock>

  ### With Badges

  Add a `badge` string and optional `badgeVariant` to any node. Badges appear after the label and support five semantic color tones: `default`, `success`, `warning`, `info`, and `destructive`.

  <ExampleBlock
    code={`import { Tree } from "@glinui/ui"

const nodes = [
  {
    label: "packages",
    children: [
      { label: "ui",       badge: "stable", badgeVariant: "success",     children: [{ label: "index.ts" }] },
      { label: "tokens",   badge: "stable", badgeVariant: "success",     children: [{ label: "theme.css" }] },
      { label: "motion",   badge: "beta",   badgeVariant: "warning",     children: [{ label: "index.ts" }] },
      { label: "registry", badge: "wip",    badgeVariant: "info",        children: [{ label: "index.ts" }] }
    ]
  }
]

export function TreeBadgeDemo() {
  return <Tree nodes={nodes} className="max-w-xs" />
}`}
  >
    <Tree nodes={badgeNodes} className="max-w-xs" />
  </ExampleBlock>

  ### buildFileTree Utility

  `buildFileTree` converts a flat array of slash-separated file paths into a nested `TreeNode[]` structure. Pass an optional `hrefPrefix` to make leaf nodes into links, or `getBadge` to attach badges based on file path patterns.

  <ExampleBlock
    code={`import { Tree, buildFileTree } from "@glinui/ui"

const paths = [
  "src/components/button.tsx",
  "src/components/input.tsx",
  "src/lib/cn.ts",
  "src/lib/utils.ts",
  "src/index.ts",
  "package.json"
]

export function TreeBuildFileTreeDemo() {
  const nodes = buildFileTree(paths)
  return <Tree nodes={nodes} className="max-w-xs" />
}

// With href links and badges:
export function TreeBuildFileTreeLinkedDemo() {
  const nodes = buildFileTree(paths, {
    hrefPrefix: "https://github.com/org/repo/blob/main",
    getBadge: (path) => {
      if (path.endsWith(".tsx")) return { badge: "tsx", badgeVariant: "info" }
      if (path.endsWith(".ts"))  return { badge: "ts",  badgeVariant: "default" }
      return null
    }
  })
  return <Tree nodes={nodes} className="max-w-xs" />
}`}
  >
    <Tree nodes={buildFileTreePreviewNodes} className="max-w-xs" />
  </ExampleBlock>

  ### Collapsed by Default

  Set `defaultExpanded={false}` to render all folders in their collapsed state initially.

  <ExampleBlock
    code={`import { Tree } from "@glinui/ui"

const nodes = [
  {
    label: "src",
    children: [
      { label: "components", children: [{ label: "button.tsx" }, { label: "input.tsx" }] },
      { label: "index.ts" }
    ]
  },
  { label: "package.json" }
]

export function TreeCollapsedDemo() {
  return <Tree nodes={nodes} defaultExpanded={false} className="max-w-xs" />
}`}
  >
    <Tree nodes={basicNodes} defaultExpanded={false} className="max-w-xs" />
  </ExampleBlock>

  ## Accessibility

  - Folder nodes render as `<button>` elements, making them keyboard-activatable with `Enter` and `Space`.
  - The chevron icon provides a clear visual indicator of expanded/collapsed state.
  - Leaf nodes that have an `href` render as `<a>` elements with proper `rel="noopener noreferrer"` when `external` is set.
  - Nesting depth is communicated visually through `padding-left` indentation. For screen-reader depth cues, consider wrapping the component in a `<nav>` with an `aria-label`.

  ## Reduced Motion

  The chevron rotation transition (`duration-150`) is a lightweight CSS transform. It respects `prefers-reduced-motion` via Tailwind's `motion-reduce:transition-none` utility if applied to `spotlightClassName`, and can be suppressed by adding `motion-reduce:transition-none` to the `className` prop.

  ## API Reference

  ### Tree

  <PropsTable componentId="tree" propsType="TreeProps" autoAppendGenerated />

  ### TreeNode

  | Prop | Type | Description |
  | --- | --- | --- |
  | `label` | `string` | Display text for the node. |
  | `children` | `TreeNode[]` | Nested child nodes; presence makes the node a folder. |
  | `href` | `string` | Optional URL for leaf nodes. |
  | `external` | `boolean` | Opens `href` in a new tab with `rel="noopener noreferrer"`. |
  | `badge` | `string` | Short badge text shown after the label. |
  | `badgeVariant` | `"default" \| "success" \| "warning" \| "info" \| "destructive"` | Semantic badge tone. |
  | `icon` | `React.ReactNode` | Custom leaf icon override (defaults to `FileText`). |

  ### buildFileTree

  ```ts
  function buildFileTree(
    paths: string[],
    options?: {
      hrefPrefix?: string
      getBadge?: (path: string) => { badge: string; badgeVariant?: TreeNode["badgeVariant"] } | null
    }
  ): TreeNode[]
  ```

  Converts a flat array of slash-separated paths into a nested `TreeNode[]`. The `hrefPrefix` is prepended to each leaf path to form a link URL. `getBadge` receives the full file path and returns badge metadata or `null`.

  ## Source

  ```tsx
  import { Tree, buildFileTree } from "@glinui/ui"
  ```

  {item?.files?.map((file) => (
    <div key={file} className="font-mono text-sm text-neutral-600 dark:text-neutral-300">
      {file}
    </div>
  ))}
</ComponentDocLayout>
