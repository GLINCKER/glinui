import { getRegistryItem } from "@glinui/registry"
import { DataTable } from "@glinui/ui"
import { ComponentDocLayout } from "@/components/docs/component-doc-layout"
import { ExampleBlock } from "@/components/docs/example-block"
import { InstallTabs } from "@/components/docs/install-tabs"
import { getComponentSources } from "@/lib/get-component-source"
import { PropsTable } from "@/components/docs/props-table"
import { createDocsMetadata } from "@/lib/docs-metadata"

export const dynamic = "force-static"
export const item = getRegistryItem("data-table")
export const sources = getComponentSources(item?.files)
export const metadata = createDocsMetadata({
  title: "Data Table",
  description: item?.description ??
    "Feature-rich table wrapper with search, sorting, pagination, selection, and column controls.",
  path: "/docs/components/data-table"
})

export const pipelineColumns = [
  { id: "account", header: "Account", accessor: "account", sortable: true },
  { id: "stage", header: "Stage", accessor: "stage", sortable: true },
  { id: "owner", header: "Owner", accessor: "owner", sortable: true },
  { id: "arr", header: "ARR", accessor: "arr", sortable: true, align: "right" }
]

export const pipelineRows = [
  { id: "op-4012", account: "Northwind", stage: "Qualified", owner: "Maya", arr: "$42,000" },
  { id: "op-4015", account: "Stellar Forge", stage: "Proposal", owner: "Ilya", arr: "$18,500" },
  { id: "op-4018", account: "Blue Harbor", stage: "Won", owner: "Rae", arr: "$63,200" },
  { id: "op-4021", account: "Arcadia Labs", stage: "Discovery", owner: "Nico", arr: "$11,900" },
  { id: "op-4022", account: "Halcyon", stage: "Qualified", owner: "Leah", arr: "$27,600" },
  { id: "op-4027", account: "Atlas Cloud", stage: "Proposal", owner: "Jules", arr: "$33,800" }
]

<ComponentDocLayout
  badgeLabel="Primitive / Organism"
  componentId="data-table"
  implementation="base"
  title="Data Table"
  description={item?.description ?? "Feature-rich table wrapper with search, sorting, pagination, selection, and column controls."}
>
  ## Installation

  Install from the package for shared ownership, or from the registry when you want copy-paste control.

  ### Package Manager

  <InstallTabs sources={sources} command={item?.install.package ?? "pnpm add @glinui/ui @glinui/tokens"} />

  ### Registry

  <InstallTabs command={item?.install.registry ?? "pnpm dlx @glinui/cli@latest add data-table"} />

  ## Usage

  `DataTable` builds on the base `Table` primitive and adds first-party behaviors: search, sorting, selection, pagination, and column visibility.

  <ExampleBlock
    codeDefaultOpen
    code={`import { Badge, DataTable } from "@glinui/ui"

const columns = [
  { id: "account", header: "Account", accessor: "account", sortable: true },
  {
    id: "stage",
    header: "Stage",
    accessor: "stage",
    sortable: true,
    cell: ({ value }) => (
      <Badge variant={value === "Won" ? "glass" : value === "Qualified" ? "outline" : "ghost"}>
        {String(value)}
      </Badge>
    )
  },
  { id: "owner", header: "Owner", accessor: "owner", sortable: true },
  { id: "arr", header: "ARR", accessor: "arr", sortable: true, align: "right" }
]

const rows = [
  { id: "op-4012", account: "Northwind", stage: "Qualified", owner: "Maya", arr: "$42,000" },
  { id: "op-4015", account: "Stellar Forge", stage: "Proposal", owner: "Ilya", arr: "$18,500" },
  { id: "op-4018", account: "Blue Harbor", stage: "Won", owner: "Rae", arr: "$63,200" },
  { id: "op-4021", account: "Arcadia Labs", stage: "Discovery", owner: "Nico", arr: "$11,900" }
]

export function DataTableBasicDemo() {
  return (
    <DataTable
      columns={columns}
      data={rows}
      selectable
      variant="glass"
      striped
      grid
      pageSize={3}
      getRowId={(row) => row.id}
    />
  )
}`}
  >
    <DataTable
      columns={pipelineColumns}
      data={pipelineRows}
      selectable
      variant="glass"
      striped
      grid
      pageSize={3}
    />
  </ExampleBlock>

  ## Examples

  ### Compact Board With Sticky Header

  <ExampleBlock
    code={`import { DataTable } from "@glinui/ui"

export function DataTableCompactDemo() {
  return (
    <DataTable
      columns={[
        { id: "account", header: "Account", accessor: "account", sortable: true },
        { id: "stage", header: "Stage", accessor: "stage", sortable: true },
        { id: "owner", header: "Owner", accessor: "owner", sortable: true },
        { id: "arr", header: "ARR", accessor: "arr", sortable: true, align: "right" },
      ]}
      data={[
        { id: "op-4012", account: "Northwind", stage: "Qualified", owner: "Maya", arr: "$42,000" },
        { id: "op-4015", account: "Stellar Forge", stage: "Proposal", owner: "Ilya", arr: "$18,500" },
        { id: "op-4018", account: "Blue Harbor", stage: "Won", owner: "Rae", arr: "$63,200" },
        { id: "op-4021", account: "Arcadia Labs", stage: "Discovery", owner: "Nico", arr: "$11,900" },
        { id: "op-4022", account: "Halcyon", stage: "Qualified", owner: "Leah", arr: "$27,600" },
      ]}
      getRowId={(row) => row.id}
      variant="matte"
      size="sm"
      stickyHeader
      containerClassName="max-h-72"
      pageSize={5}
      searchable
    />
  )
}`}
  >
    <DataTable
      columns={pipelineColumns}
      data={pipelineRows}
      variant="matte"
      size="sm"
      stickyHeader
      containerClassName="max-h-72"
      pageSize={5}
      searchable
    />
  </ExampleBlock>

  ### Selection + Column Controls

  Enable `selectable` and hide low-priority columns with `hidden`/`canHide` to keep dense dashboards readable.

  <ExampleBlock
    code={`import { DataTable } from "@glinui/ui"

export function DataTableSelectionDemo() {
  return (
    <DataTable
      columns={[
        { id: "account", header: "Account", accessor: "account", sortable: true },
        { id: "stage", header: "Stage", accessor: "stage", sortable: true },
        { id: "owner", header: "Owner", accessor: "owner", sortable: true, hidden: true, canHide: true },
        { id: "arr", header: "ARR", accessor: "arr", sortable: true, align: "right" },
      ]}
      data={[
        { id: "op-4012", account: "Northwind", stage: "Qualified", owner: "Maya", arr: "$42,000" },
        { id: "op-4015", account: "Stellar Forge", stage: "Proposal", owner: "Ilya", arr: "$18,500" },
        { id: "op-4018", account: "Blue Harbor", stage: "Won", owner: "Rae", arr: "$63,200" },
        { id: "op-4021", account: "Arcadia Labs", stage: "Discovery", owner: "Nico", arr: "$11,900" },
      ]}
      selectable
      variant="outline"
      pageSize={4}
    />
  )
}`}
  >
    <DataTable
      columns={[
        { id: "account", header: "Account", accessor: "account", sortable: true },
        { id: "stage", header: "Stage", accessor: "stage", sortable: true },
        { id: "owner", header: "Owner", accessor: "owner", sortable: true, hidden: true, canHide: true },
        { id: "arr", header: "ARR", accessor: "arr", sortable: true, align: "right" }
      ]}
      data={pipelineRows.slice(0, 4)}
      selectable
      variant="outline"
      pageSize={4}
    />
  </ExampleBlock>

  ### Server Data Pattern

  For large datasets, fetch and paginate on the server, then pass only the current page to `DataTable`.

  <ExampleBlock
    code={`"use client"

import * as React from "react"
import { DataTable } from "@glinui/ui"

const columns = [
  { id: "account", header: "Account", accessor: "account", sortable: true },
  { id: "stage", header: "Stage", accessor: "stage", sortable: true },
  { id: "arr", header: "ARR", accessor: "arr", sortable: true, align: "right" }
]

export function DataTableServerPattern() {
  const [rows, setRows] = React.useState([])
  const [query, setQuery] = React.useState("")
  const [page, setPage] = React.useState(1)

  React.useEffect(() => {
    const params = new URLSearchParams({ q: query, page: String(page) })
    fetch(\`/api/pipeline?\${params.toString()}\`)
      .then((res) => res.json())
      .then((payload) => setRows(payload.items))
  }, [query, page])

  return (
    <DataTable
      columns={columns}
      data={rows}
      searchable={false}
      pageSize={20}
      variant="glass"
      emptyMessage="No matching records."
    />
  )
}`}
  >
    <div className="w-full max-w-3xl rounded-xl border border-border/60 bg-background/30 p-4 text-sm text-neutral-600 dark:text-neutral-300">
      Use this pattern when your API owns filtering, sorting, and pagination.
    </div>
  </ExampleBlock>

  ## Accessibility

  - Built on semantic table elements (`table`, `thead`, `tbody`, `th`, and `td`) for screen-reader compatibility.
  - Search input, page-size select, and selection checkboxes ship with labels by default.
  - Sort actions are focusable controls in headers and work with keyboard activation (`Enter` / `Space`).
  - Keep column names concise and unique so assistive tech announces context clearly.

  ## Reduced Motion

  DataTable inherits reduced-motion behavior from `Table`, `Input`, `Select`, and `Button`. Hover/focus transitions are non-essential and respect user preference settings.

  ## API Reference

  <PropsTable componentId="data-table" autoAppendGenerated />

  ## Source

  ```tsx
  import { DataTable } from "@glinui/ui"
  ```

  {item?.files?.map((file) => (
    <div key={file} className="font-mono text-sm text-neutral-600 dark:text-neutral-300">
      {file}
    </div>
  ))}
</ComponentDocLayout>
