import { getRegistryItem } from "@glinui/registry"
import { Avatar, AvatarGroup } from "@glinui/ui"
import { ComponentDocLayout } from "@/components/docs/component-doc-layout"
import { ExampleBlock } from "@/components/docs/example-block"
import { InstallTabs } from "@/components/docs/install-tabs"
import { getComponentSources } from "@/lib/get-component-source"
import { PropsTable } from "@/components/docs/props-table"

export const dynamic = "force-static"
export const item = getRegistryItem("avatar")
export const sources = getComponentSources(item?.files)
export const metadata = {
  title: "Avatar - Glin UI",
  description: "Profile image with glassmorphic variants, status indicators, grouped stacking, and copy-ready Tailwind recipes."
}

export const adventurerUrl = "https://api.dicebear.com/9.x/adventurer/svg?seed=Nova"
export const loreleiUrl = "https://api.dicebear.com/9.x/lorelei/svg?seed=Kai"
export const botttsUrl = "https://api.dicebear.com/9.x/bottts/svg?seed=Glin"
export const pixelUrl = "https://api.dicebear.com/9.x/pixel-art/svg?seed=Leo"
export const thumbsUrl = "https://api.dicebear.com/9.x/thumbs/svg?seed=Aria"

<ComponentDocLayout
  badgeLabel="Primitive / Atom"
  componentId="avatar"
  implementation="radix"
  title="Avatar"
  description="Profile image with glassmorphic variants, status indicators, grouped stacking, and copy-ready Tailwind recipes."
>
  ## Installation

  ### Package Manager

  <InstallTabs sources={sources} command={item?.install.package ?? "pnpm add @glinui/ui @glinui/tokens"} />

  ### Registry

  <InstallTabs command={item?.install.registry ?? "pnpm dlx @glinui/cli@latest add avatar"} />

  ## Usage

  Avatar renders an image or fallback with a predictable priority: `fallback` prop > `children` > first character of `alt` > `"?"`.

  <ExampleBlock
    codeDefaultOpen
    code={`import { Avatar } from "@glinui/ui"

export function AvatarBasicDemo() {
  return <Avatar src="https://api.dicebear.com/9.x/adventurer/svg?seed=Nova" alt="Nova" />
}`}
  >
    <Avatar src={adventurerUrl} alt="Nova" />
  </ExampleBlock>

  ## Examples

  ### Glass Variants

  Seven surface variants matching the design system. Glass and liquid use backdrop-blur with refraction edges.

  <ExampleBlock
    snippets={[
      {
        label: "TSX",
        code: `import { Avatar } from "@glinui/ui"

export function AvatarVariantsDemo() {
  return (
    <div className="flex items-center gap-4">
      <Avatar fallback="DF" alt="Default" variant="default" />
      <Avatar fallback="GL" alt="Glass" variant="glass" />
      <Avatar fallback="LQ" alt="Liquid" variant="liquid" />
      <Avatar fallback="MT" alt="Matte" variant="matte" />
      <Avatar fallback="GW" alt="Glow" variant="glow" />
      <Avatar fallback="OL" alt="Outline" variant="outline" />
      <Avatar fallback="GH" alt="Ghost" variant="ghost" />
    </div>
  )
}`,
        language: "tsx"
      },
      {
        label: "CSS",
        code: `/* Copy-paste these Tailwind classes for each variant */

/* Default — solid dark surface */
.avatar-default {
  @apply border-black/10 bg-neutral-900 text-white
    shadow-[0_4px_12px_-6px_rgb(2_6_23_/_0.45)]
    dark:border-white/15 dark:bg-neutral-100 dark:text-neutral-950;
}

/* Glass — frosted with refraction edge */
.avatar-glass {
  @apply border-white/20
    [border-top-color:var(--glass-refraction-top)]
    bg-[linear-gradient(155deg,rgb(255_255_255_/_0.62),rgb(245_245_245_/_0.36))]
    backdrop-blur-md backdrop-saturate-[180%]
    shadow-[0_0_0_1px_rgb(255_255_255_/_0.2)_inset,0_4px_12px_-6px_rgb(2_6_23_/_0.2)];
}

/* Liquid — caustic light pools */
.avatar-liquid {
  @apply border-white/20
    [border-top-color:var(--glass-refraction-top)]
    bg-[radial-gradient(circle_at_18%_16%,rgb(255_255_255_/_0.88),transparent_40%),linear-gradient(148deg,rgb(255_255_255_/_0.74),rgb(232_232_232_/_0.5))]
    backdrop-blur-xl backdrop-saturate-[180%]
    shadow-[0_0_0_1px_rgb(255_255_255_/_0.2)_inset,0_6px_16px_-8px_rgb(2_6_23_/_0.25)];
}

/* Matte — brushed aluminum */
.avatar-matte {
  @apply border-black/10
    bg-[linear-gradient(180deg,rgb(250_250_250),rgb(234_234_236))]
    text-neutral-900
    shadow-[0_1px_0_rgb(255_255_255_/_0.92)_inset,0_4px_10px_-6px_rgb(15_23_42_/_0.22)];
}

/* Glow — dark with outer luminance */
.avatar-glow {
  @apply border-white/20 bg-neutral-900 text-white
    shadow-[0_0_0_1px_rgb(255_255_255_/_0.12)_inset,0_0_16px_rgb(255_255_255_/_0.15)];
}`,
        language: "css"
      }
    ]}
    code=""
  >
    <div className="flex items-center gap-4">
      <Avatar fallback="DF" alt="Default" variant="default" />
      <Avatar fallback="GL" alt="Glass" variant="glass" />
      <Avatar fallback="LQ" alt="Liquid" variant="liquid" />
      <Avatar fallback="MT" alt="Matte" variant="matte" />
      <Avatar fallback="GW" alt="Glow" variant="glow" />
      <Avatar fallback="OL" alt="Outline" variant="outline" />
      <Avatar fallback="GH" alt="Ghost" variant="ghost" />
    </div>
  </ExampleBlock>

  ### With Images

  <ExampleBlock
    code={`import { Avatar } from "@glinui/ui"

export function AvatarImagesDemo() {
  return (
    <div className="flex items-center gap-4">
      <Avatar src="https://api.dicebear.com/9.x/adventurer/svg?seed=Nova" alt="Nova" variant="default" />
      <Avatar src="https://api.dicebear.com/9.x/lorelei/svg?seed=Kai" alt="Kai" variant="glass" />
      <Avatar src="https://api.dicebear.com/9.x/bottts/svg?seed=Glin" alt="Glin" variant="liquid" />
      <Avatar src="https://api.dicebear.com/9.x/pixel-art/svg?seed=Leo" alt="Leo" variant="matte" />
      <Avatar src="https://api.dicebear.com/9.x/thumbs/svg?seed=Aria" alt="Aria" variant="glow" />
    </div>
  )
}`}
  >
    <div className="flex items-center gap-4">
      <Avatar src={adventurerUrl} alt="Nova" variant="default" />
      <Avatar src={loreleiUrl} alt="Kai" variant="glass" />
      <Avatar src={botttsUrl} alt="Glin" variant="liquid" />
      <Avatar src={pixelUrl} alt="Leo" variant="matte" />
      <Avatar src={thumbsUrl} alt="Aria" variant="glow" />
    </div>
  </ExampleBlock>

  ### Sizes

  Six sizes from xs (24px) to 2xl (80px).

  <ExampleBlock
    code={`import { Avatar } from "@glinui/ui"

export function AvatarSizeDemo() {
  return (
    <div className="flex items-end gap-3">
      <Avatar size="xs" fallback="XS" alt="Extra small" />
      <Avatar size="sm" fallback="SM" alt="Small" />
      <Avatar size="md" fallback="MD" alt="Medium" />
      <Avatar size="lg" fallback="LG" alt="Large" />
      <Avatar size="xl" fallback="XL" alt="Extra large" />
      <Avatar size="2xl" fallback="2X" alt="Double extra large" />
    </div>
  )
}`}
  >
    <div className="flex items-end gap-3">
      <Avatar size="xs" fallback="XS" alt="Extra small" />
      <Avatar size="sm" fallback="SM" alt="Small" />
      <Avatar size="md" fallback="MD" alt="Medium" />
      <Avatar size="lg" fallback="LG" alt="Large" />
      <Avatar size="xl" fallback="XL" alt="Extra large" />
      <Avatar size="2xl" fallback="2X" alt="Double extra large" />
    </div>
  </ExampleBlock>

  ### Radius Styles

  <ExampleBlock
    code={`import { Avatar } from "@glinui/ui"

export function AvatarRadiusDemo() {
  return (
    <div className="flex items-center gap-4">
      <Avatar radius="full" fallback="FU" variant="glass" />
      <Avatar radius="lg" fallback="LG" variant="glass" />
      <Avatar radius="md" fallback="MD" variant="glass" />
      <Avatar radius="square" fallback="SQ" variant="glass" />
    </div>
  )
}`}
  >
    <div className="flex items-center gap-4">
      <Avatar radius="full" fallback="FU" variant="glass" />
      <Avatar radius="lg" fallback="LG" variant="glass" />
      <Avatar radius="md" fallback="MD" variant="glass" />
      <Avatar radius="square" fallback="SQ" variant="glass" />
    </div>
  </ExampleBlock>

  ### Status Indicator

  Show online, offline, busy, or away status with an auto-positioned dot.

  <ExampleBlock
    snippets={[
      {
        label: "TSX",
        code: `import { Avatar } from "@glinui/ui"

export function AvatarStatusDemo() {
  return (
    <div className="flex items-center gap-4">
      <Avatar src="..." alt="Online" status="online" />
      <Avatar src="..." alt="Away" status="away" />
      <Avatar src="..." alt="Busy" status="busy" />
      <Avatar src="..." alt="Offline" status="offline" />
    </div>
  )
}`,
        language: "tsx"
      },
      {
        label: "CSS",
        code: `/* Status dot — positioned absolute bottom-right */
.avatar-status-online {
  @apply absolute bottom-0 right-0 rounded-full
    h-2.5 w-2.5 bg-emerald-500
    shadow-[0_0_0_2px_var(--color-background)];
}

.avatar-status-away {
  @apply absolute bottom-0 right-0 rounded-full
    h-2.5 w-2.5 bg-amber-500
    shadow-[0_0_0_2px_var(--color-background)];
}

.avatar-status-busy {
  @apply absolute bottom-0 right-0 rounded-full
    h-2.5 w-2.5 bg-red-500
    shadow-[0_0_0_2px_var(--color-background)];
}

/* Pulse animation for online status */
@keyframes pulse-ring {
  0% { box-shadow: 0 0 0 0 rgb(16 185 129 / 0.4); }
  70% { box-shadow: 0 0 0 6px rgb(16 185 129 / 0); }
  100% { box-shadow: 0 0 0 0 rgb(16 185 129 / 0); }
}

.avatar-status-online-pulse {
  animation: pulse-ring 2s ease-out infinite;
}`,
        language: "css"
      }
    ]}
    code=""
  >
    <div className="flex items-center gap-4">
      <Avatar src={adventurerUrl} alt="Online" status="online" />
      <Avatar src={loreleiUrl} alt="Away" status="away" />
      <Avatar src={botttsUrl} alt="Busy" status="busy" />
      <Avatar src={pixelUrl} alt="Offline" status="offline" />
    </div>
  </ExampleBlock>

  ### Avatar Group

  Stack avatars with overlap. Set `max` to cap visible count with a `+N` overflow indicator.

  <ExampleBlock
    snippets={[
      {
        label: "TSX",
        code: `import { Avatar, AvatarGroup } from "@glinui/ui"

export function AvatarGroupDemo() {
  return (
    <div className="space-y-6">
      <AvatarGroup>
        <Avatar src="..." alt="Nova" />
        <Avatar src="..." alt="Kai" />
        <Avatar src="..." alt="Glin" />
        <Avatar src="..." alt="Leo" />
      </AvatarGroup>

      <AvatarGroup max={3}>
        <Avatar src="..." alt="Nova" />
        <Avatar src="..." alt="Kai" />
        <Avatar src="..." alt="Glin" />
        <Avatar src="..." alt="Leo" />
        <Avatar src="..." alt="Aria" />
      </AvatarGroup>
    </div>
  )
}`,
        language: "tsx"
      },
      {
        label: "CSS",
        code: `/* Avatar group overlap */
.avatar-group {
  @apply flex items-center -space-x-2;
}

.avatar-group > * {
  @apply ring-2 ring-[var(--color-background)] rounded-full;
}

/* Overflow counter */
.avatar-group-overflow {
  @apply flex h-10 w-10 items-center justify-center rounded-full
    border border-[var(--color-border)] bg-[var(--color-surface)]
    text-xs font-semibold text-[var(--color-foreground)]
    ring-2 ring-[var(--color-background)];
}

/* Spacing variants */
.avatar-group-tight  { @apply -space-x-3; }
.avatar-group-normal { @apply -space-x-2; }
.avatar-group-loose  { @apply -space-x-1; }`,
        language: "css"
      }
    ]}
    code=""
  >
    <div className="space-y-6">
      <AvatarGroup>
        <Avatar src={adventurerUrl} alt="Nova" />
        <Avatar src={loreleiUrl} alt="Kai" />
        <Avatar src={botttsUrl} alt="Glin" />
        <Avatar src={pixelUrl} alt="Leo" />
      </AvatarGroup>

      <AvatarGroup max={3}>
        <Avatar src={adventurerUrl} alt="Nova" />
        <Avatar src={loreleiUrl} alt="Kai" />
        <Avatar src={botttsUrl} alt="Glin" />
        <Avatar src={pixelUrl} alt="Leo" />
        <Avatar src={thumbsUrl} alt="Aria" />
      </AvatarGroup>
    </div>
  </ExampleBlock>

  ### Glass Variants with Status

  Combine glass surfaces with status indicators for rich profile displays.

  <ExampleBlock
    code={`import { Avatar } from "@glinui/ui"

export function AvatarGlassStatusDemo() {
  return (
    <div className="flex items-center gap-4">
      <Avatar src="..." alt="Nova" variant="glass" size="lg" status="online" />
      <Avatar src="..." alt="Kai" variant="liquid" size="lg" status="away" />
      <Avatar src="..." alt="Glin" variant="matte" size="lg" status="busy" />
      <Avatar src="..." alt="Leo" variant="glow" size="lg" status="offline" />
    </div>
  )
}`}
  >
    <div className="flex items-center gap-4">
      <Avatar src={adventurerUrl} alt="Nova" variant="glass" size="lg" status="online" />
      <Avatar src={loreleiUrl} alt="Kai" variant="liquid" size="lg" status="away" />
      <Avatar src={botttsUrl} alt="Glin" variant="matte" size="lg" status="busy" />
      <Avatar src={pixelUrl} alt="Leo" variant="glow" size="lg" status="offline" />
    </div>
  </ExampleBlock>

  ### Copy-Paste Recipes

  Drop these Tailwind classes directly into your markup for common avatar patterns.

  <ExampleBlock
    snippets={[
      {
        label: "Recipes",
        code: `/* ── Profile card avatar ──────────────────── */
<img class="
  h-16 w-16 rounded-full border-2 border-white/20
  [border-top-color:var(--glass-refraction-top)]
  bg-[linear-gradient(155deg,rgb(255_255_255_/_0.62),rgb(245_245_245_/_0.36))]
  backdrop-blur-md backdrop-saturate-[180%]
  shadow-[0_0_0_1px_rgb(255_255_255_/_0.2)_inset,0_6px_16px_-8px_rgb(2_6_23_/_0.25)]
  object-cover
  transition-transform duration-300 ease-[cubic-bezier(0.2,0,0,1)]
  hover:scale-105
" />

/* ── Sidebar nav avatar with glow ────────── */
<div class="
  h-10 w-10 rounded-full
  border border-white/20 bg-neutral-900
  shadow-[0_0_0_1px_rgb(255_255_255_/_0.12)_inset,0_0_16px_rgb(255_255_255_/_0.15)]
  flex items-center justify-center
  text-sm font-semibold text-white
  transition-shadow duration-250
  hover:shadow-[0_0_0_1px_rgb(255_255_255_/_0.14)_inset,0_0_24px_rgb(255_255_255_/_0.25)]
"/>

/* ── Comment thread avatar (matte) ───────── */
<img class="
  h-8 w-8 rounded-full
  border border-black/10
  bg-[linear-gradient(180deg,rgb(250_250_250),rgb(234_234_236))]
  shadow-[0_1px_0_rgb(255_255_255_/_0.92)_inset,0_4px_10px_-6px_rgb(15_23_42_/_0.22)]
  object-cover
"/>

/* ── Hero avatar with hover lift ─────────── */
<img class="
  h-20 w-20 rounded-full
  border-2 border-white/20
  [border-top-color:var(--glass-refraction-top)]
  bg-[radial-gradient(circle_at_18%_16%,rgb(255_255_255_/_0.88),transparent_40%),linear-gradient(148deg,rgb(255_255_255_/_0.74),rgb(232_232_232_/_0.5))]
  backdrop-blur-xl backdrop-saturate-[180%]
  shadow-[0_0_0_1px_rgb(255_255_255_/_0.2)_inset,0_10px_24px_-8px_rgb(2_6_23_/_0.3)]
  object-cover
  transition-[transform,box-shadow] duration-300 ease-[cubic-bezier(0.2,0,0,1)]
  hover:-translate-y-1
  hover:shadow-[0_0_0_1px_rgb(255_255_255_/_0.24)_inset,0_16px_32px_-8px_rgb(2_6_23_/_0.35)]
"/>`,
        language: "html"
      },
      {
        label: "TSX",
        code: `import { Avatar, AvatarGroup } from "@glinui/ui"

// Profile card
<Avatar src={user.avatar} alt={user.name} variant="glass" size="2xl" />

// Sidebar nav
<Avatar fallback="JD" variant="glow" size="md" />

// Comment thread
<Avatar src={author.avatar} alt={author.name} variant="matte" size="sm" />

// Hero with group
<AvatarGroup max={4} spacing="tight">
  {team.map(m => (
    <Avatar key={m.id} src={m.avatar} alt={m.name} variant="liquid" size="lg" />
  ))}
</AvatarGroup>`,
        language: "tsx"
      }
    ]}
    code=""
  >
    <div className="flex flex-col items-center gap-6">
      <div className="flex items-center gap-4">
        <Avatar src={adventurerUrl} alt="Nova" variant="glass" size="2xl" />
        <Avatar fallback="JD" variant="glow" size="md" />
        <Avatar src={loreleiUrl} alt="Kai" variant="matte" size="sm" />
      </div>
      <AvatarGroup max={4} spacing="tight">
        <Avatar src={adventurerUrl} alt="Nova" variant="liquid" size="lg" />
        <Avatar src={loreleiUrl} alt="Kai" variant="liquid" size="lg" />
        <Avatar src={botttsUrl} alt="Glin" variant="liquid" size="lg" />
        <Avatar src={pixelUrl} alt="Leo" variant="liquid" size="lg" />
        <Avatar src={thumbsUrl} alt="Aria" variant="liquid" size="lg" />
      </AvatarGroup>
    </div>
  </ExampleBlock>

  ### Image Error Recovery

  A broken image source falls back instantly, and if `src` later changes to a valid URL, the image renders again.

  <ExampleBlock
    code={`import { Avatar } from "@glinui/ui"

export function AvatarErrorDemo() {
  return (
    <div className="flex items-center gap-3">
      <Avatar src="/broken-src.png" alt="Broken" fallback="BR" variant="matte" />
      <Avatar src="https://api.dicebear.com/9.x/adventurer/svg?seed=Replaced" alt="Recovered" variant="glass" />
    </div>
  )
}`}
  >
    <div className="flex items-center gap-3">
      <Avatar src="/broken-src.png" alt="Broken" fallback="BR" variant="matte" />
      <Avatar src="https://api.dicebear.com/9.x/adventurer/svg?seed=Replaced" alt="Recovered" variant="glass" />
    </div>
  </ExampleBlock>

  ## Accessibility

  - Provide a meaningful `alt` for identity-bearing avatars.
  - Keep consistent avatar sizes in list/table contexts to reduce visual noise.
  - Fallback initials ensure content remains identifiable when images fail.
  - Status indicators include `aria-label` for screen readers.

  ## Reduced Motion

  Transition effects on hover (scale, shadow) respect `prefers-reduced-motion` via the `motion-reduce:transition-none` utility.

  ## API Reference

  ### Avatar

  <PropsTable componentId="avatar" propsType="AvatarProps" autoAppendGenerated />

  ### AvatarGroup

  <PropsTable componentId="avatar" propsType="AvatarGroupProps" autoAppendGenerated />

  ## Source

  ```tsx
  import { Avatar, AvatarGroup } from "@glinui/ui"
  ```

  {item?.files?.map((file) => (
    <div key={file} className="font-mono text-sm text-neutral-600 dark:text-neutral-300">
      {file}
    </div>
  ))}
</ComponentDocLayout>
